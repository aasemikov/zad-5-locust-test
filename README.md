# Отчёт о нагрузочном тестировании сервиса: Сравнение REST API и gRPC
Дата проведения: 2026-01-17
Выполнил: Семиков Алексей

## 1. Описание тестируемого приложения

Описание REST API [здесь](https://github.com/aasemikov/rest-fastapi-swagger/blob/master/README.md)
Описание gRPC [здесь](https://github.com/aasemikov/rpc-grpc-protobuf/blob/master/README.md)

## 2. Настройки тестовой среды
Аппаратные ресурсы:

- Компьютер: Apple MacBook Pro 14" (2024)
- CPU: Apple M4 Pro, 12 ядер
- RAM: 24 ГБ унифицированной памяти
- Хранилище: SSD NVMe (на основе архитектуры Apple Silicon, высокая скорость IO)
- Сеть: Тестирование проводилось через петлевой интерфейс (localhost), все компоненты запущены на одной машине.
- ОС: macOS (актуальная версия, например macOS Sequoia 15.x)
- Архитектура стенда:

REST-сервер: http://localhost:8000

gRPC-сервер: localhost:50051

Агент нагрузки Locust запущен на той же машине.

Дополнительные инструменты мониторинга: Не использовались.

## 3. Тестовые сценарии
#### Сценарий 1: REST — Постепенное увеличение нагрузки (Ramp-up)
##### Логика поведения: Смешанная нагрузка: чтение (GET главной страницы, списков с разной пагинацией, несуществующих терминов) и операции записи (POST, PUT, DELETE), которые часто завершаются ошибками 404/400 из-за отсутствия данных.
Конфигурация нагрузки:
- Этап 1 (09:07:44 - 09:08:44): Начало, низкая нагрузка.
- Этап 2 (09:08:44 - 09:13:44): 5 минут стабильной нагрузки.
- Этап 3 (09:13:45 - 09:16:44): 3 минуты более высокой нагрузки (RPS вырос с ~14.3 до ~57.0).

Ожидания: Проверить стабильность сервиса при росте числа пользователей, выявить порог деградации и изучить характер ошибок.

#### Сценарий 2: gRPC — "Санкей" (Sanity Check)
##### Логика поведения: Упрощённый тест для проверки корректности работы gRPC-сервиса. Включает все основные операции (добавление, получение одного, получение всех, поиск, фильтрация по категории).
Конфигурация нагрузки:
Пользователи: 5.
Spawn Rate / Длительность: Постепенный рост до 5 пользователей, затем около 1.5 минуты стабильной нагрузки.
Ожидания: Убедиться, что все эндпоинты gRPC работают без ошибок, замерить базовые показатели производительности (латентность, RPS) для сравнения с REST.

## 4. Результаты тестирования
#### 4.1. Основные метрики
| Метрика / Подход                | REST (высокая нагрузка) | gRPC (лёгкая нагрузка) |
|---------------------------------|-------------------------|------------------------|
| Общее количество запросов       | 10 250                  | 166                    |
| Общее количество ошибок         | 4 408                   | 0                      |
| Коэффициент ошибок              | ~43%                    | 0%                     |
| Среднее время ответа (среднее)  | 7 мс                    | ~2.98 мс               |
| Среднее время ответа (медиана)  | 7 мс                    | 3 мс                   |
| Процентиль 95 (p95)             | 15 мс                   | 4-5 мс                 |
| Процентиль 99 (p99)             | 21 мс                   | 5 мс                   |
| Максимальное время ответа       | 53 мс                   | 5 мс                   |
| Пропускная способность (RPS)    | 57.0 RPS                | 2.82 RPS               |
| Ошибок в секунду                | 24.5                    | 0                      |

Анализ ошибок (REST):

404 Not Found: GET /terms/[key] (2494 ошибки), PUT /terms/[key] (492), DELETE /terms/[key] (67). Указывает на то, что тестовые данные для обновления/удаления не существуют.

400 Bad Request: POST /terms/ (1355 ошибок с деталью "Term already exists"). Указывает на конфликты при создании из-за неуникальности ключей.

Вывод: Тестовый сценарий REST не является идемпотентным и не управляет состоянием тестовых данных, что приводит к высокому проценту ожидаемых ошибок логики приложения.

#### 4.2. Анализ результатов
Деградация: В рамках теста REST (до 57 RPS) явной деградации не наблюдается. Время ответа стабильно (~7 мс в среднем), p99 не превышает 21 мс. Это говорит о том, что сервис не достиг предела производительности на данном стенде.

Латентность при росте нагрузки: При росте RPS с ~14 до ~57 (в 4 раза) среднее время ответа REST улучшилось с 9 мс до 7 мс, а p99 снизился с 35 мс до 21 мс. Это парадоксальный результат, который может объясняться прогревом кэшей (БД, приложения) или стабилизацией работы JIT-компилятора Python.

"Бутылочное горлышко": На данном этапе явного узкого места не выявлено. Низкая латентность и отсутствие роста времени ответа указывают, что ни CPU, ни БД, ни сеть не были нагружены максимально. Основная проблема — архитектура теста (REST).

Сравнение REST и gRPC:

Латентность: gRPC демонстрирует в 2-3 раза меньшую задержку (3 мс медиана против 7 мс у REST). Это ожидаемо из-за бинарного формата protobuf и более эффективного HTTP/2.

Overhead: gRPC показывает меньший разброс времени ответа (max 5 мс против 53 мс у REST) и стабильные перцентили.

Стабильность: gRPC-тест прошёл без единой ошибки, в отличие от REST, где 43% запросов завершились с ошибкой приложения.

## 5. Сравнение REST и gRPC
| Критерий | REST API | gRPC | Вывод |
|:---------|:--------:|:----:|:------|
| Средняя латентность | 7-9 мс | ~3 мс | gRPC быстрее в 2-3 раза |
| Стабильность (p95/p99) | 15-35 мс / 21-66 мс | 4-5 мс / 5 мс | gRPC значительно стабильнее |
| Пропускная способность (RPS) | 57.0 (при 43% ошибок) | 2.82 (без ошибок) | Сравнение некорректно из-за разной нагрузки |
| Нагрузка на сеть (overhead) | Выше (текстовый JSON, HTTP/1.1) | Ниже (бинарный protobuf, HTTP/2) | gRPC эффективнее |
| Надёжность/Ошибки | 43% ошибок (4xx) | 0% ошибок | gRPC-тест более корректен |

Вывод о применимости:
gRPC предпочтительнее для внутренней микросервисной коммуникации, где критичны низкая латентность, высокая пропускная способность и эффективность.
REST остаётся хорошим выбором для публичных API, где важна простота отладки (читаемый JSON), кэширование на HTTP-уровне и широкая поддержка клиентов (браузеры, мобильные приложения).

## 6. Заключение
Основные выводы:
gRPC превосходит REST по ключевым метрикам производительности (латентность, стабильность, эффективность сети) в условиях данного теста.
REST-сервис показал хорошую устойчивость к нагрузке до 57 RPS без признаков деградации, но тестовый сценарий был составлен неполно, что привело к высокому проценту ошибок 4xx.

Рекомендации по оптимизации:

Для REST: Оптимизировать не требуется с точки зрения производительности на данной нагрузке. Следует переработать тестовый сценарий: использовать уникальные идентификаторы, предварительно создавать данные для обновления/удаления, снизив таким образом процент ложных ошибок.

Для gRPC: Результаты теста (sanity check) обнадёживают. Для полноценной оценки необходимо провести стресс-тест gRPC с нагрузкой.

