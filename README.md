# Отчёт о нагрузочном тестировании сервиса: Сравнение REST API и gRPC
Дата проведения: 2026-01-17
Выполнил: Семиков Алексей

## 1. Описание тестируемого приложения

Описание REST API [здесь](https://github.com/aasemikov/rest-fastapi-swagger/blob/master/README.md)
Описание gRPC [здесь](https://github.com/aasemikov/rpc-grpc-protobuf/blob/master/README.md)

## 2. Настройки тестовой среды
Аппаратные ресурсы:

- Компьютер: Apple MacBook Pro 14" (2024)
- CPU: Apple M4 Pro, 12 ядер
- RAM: 24 ГБ унифицированной памяти
- Хранилище: SSD NVMe (на основе архитектуры Apple Silicon, высокая скорость IO)
- Сеть: Тестирование проводилось через петлевой интерфейс (localhost), все компоненты запущены на одной машине.
- ОС: macOS (актуальная версия, например macOS Sequoia 15.x)
- Архитектура стенда:

REST-сервер: http://localhost:8000

gRPC-сервер: localhost:50051

Агент нагрузки Locust запущен на той же машине.

Дополнительные инструменты мониторинга: Не использовались.

## 3. Тестовые сценарии
#### Сценарий 1: REST — Постепенное увеличение нагрузки (Ramp-up)
##### Логика поведения: Смешанная нагрузка: чтение (GET главной страницы, списков с разной пагинацией, несуществующих терминов) и операции записи (POST, PUT, DELETE), которые часто завершаются ошибками 404/400 из-за отсутствия данных.
Конфигурация нагрузки:
- Этап 1 (09:07:44 - 09:08:44): Начало, низкая нагрузка.
- Этап 2 (09:08:44 - 09:13:44): 5 минут стабильной нагрузки.
- Этап 3 (09:13:45 - 09:16:44): 3 минуты более высокой нагрузки (RPS вырос с ~14.3 до ~57.0).

Ожидания: Проверить стабильность сервиса при росте числа пользователей, выявить порог деградации и изучить характер ошибок.

#### Сценарий 2: gRPC — "Санкей" (Sanity Check)
##### Логика поведения: Упрощённый тест для проверки корректности работы gRPC-сервиса. Включает все основные операции (добавление, получение одного, получение всех, поиск, фильтрация по категории).
Конфигурация нагрузки:
Пользователи: 5.
Spawn Rate / Длительность: Постепенный рост до 5 пользователей, затем около 1.5 минуты стабильной нагрузки.
Ожидания: Убедиться, что все эндпоинты gRPC работают без ошибок, замерить базовые показатели производительности (латентность, RPS) для сравнения с REST.

#### 3.3. Сценарий 3: gRPC — Стресс-тест
Пользователи: 300 (быстрый рост за 10 секунд)
Длительность: ~4.5 минуты
Стабильная фаза: 4 минуты при 300 пользователях
Методы: Все операции с акцентом на чтение

#### 3.4. Сценарий 4: gRPC — Стабильная нагрузка
Пользователи: 100
Длительность: ~14.5 минут
Методы: Все операции gRPC

## 4. Результаты тестирования
#### 4.1. Основные метрики
| Метрика / Сценарий           | REST (пик)     | gRPC (санкей)  | gRPC (стресс)  | gRPC (стабильный) |
|------------------------------|----------------|----------------|----------------|-------------------|
| **Пользователи**             | ~50            | 5              | 300            | 100               |
| **Длительность**             | 9 мин          | 1.5 мин        | 4.5 мин        | 14.5 мин          |
| **Всего запросов**           | 10,250         | 166            | 50,716         | 68,030            |
| **Ошибки**                   | 4,408 (43%)    | 0 (0%)         | 0 (0%)         | 0 (0%)            |
| **Среднее время ответа**     | 7 мс           | 2.98 мс        | 1.63 мс        | 4.83 мс           |
| **Медиана**                  | 7 мс           | 3 мс           | 1 мс           | 2 мс              |
| **p95**                      | 15 мс          | 4-5 мс         | 4 мс           | 7 мс              |
| **p99**                      | 21 мс          | 5 мс           | 5 мс           | 9 мс              |
| **Максимум**                 | 53 мс          | 5 мс           | 34 мс          | 115,246 мс        |
| **RPS**                      | 57.0           | 2.82           | 169.1          | 34.0              |
| **Ошибок/сек**               | 24.5           | 0              | 0              | 0                 |

Анализ ошибок (REST):

404 Not Found: 3,053 ошибки (GET/PUT/DELETE по несуществующим ключам)

400 Bad Request: 1,355 ошибок (POST с дублирующимися терминами)

Общий процент ошибок: 43% (все ошибки — логические 4xx)

## Сравнение результатов

#### 5.1. Производительность
| Критерий                 | REST API               | gRPC                   | Вывод                              |
|--------------------------|------------------------|------------------------|------------------------------------|
| **Средняя латентность**  | 7-9 мс                 | 1.6-4.8 мс             | gRPC быстрее в 1.5-5.5 раз         |
| **Стабильность (p95/p99)** | 15-35/21-66 мс       | 4-7/5-9 мс             | gRPC значительно стабильнее        |
| **Максимальная RPS**     | 57.0 (с ошибками)      | 169.1 (без ошибок)     | gRPC выдерживает в 3 раза больше нагрузки |
| **Протокол/сериализация** | HTTP/1.1 + JSON      | HTTP/2 + Protobuf      | gRPC эффективнее                   |
| **Надёжность**           | 43% ошибок (4xx)       | 0% ошибок              | gRPC тест более корректен          |

#### 5.2. Анализ производительности по операциям
Операции чтения:
- REST GET: ~5-11 мс
- gRPC GetTerm: ~1-3 мс (в 3-5 раз быстрее)

Операции записи:
- REST POST: ~11-14 мс
- gRPC AddTerm: ~1-3 мс (в 4-7 раз быстрее)

Сложные операции:
- REST пагинация: ~9-13 мс
- gRPC SearchTerms: ~3-7 мс (в 1.5-3 раза быстрее)

#### 5.3. Overhead анализа
Сетевой overhead: gRPC использует бинарный Protobuf, что на 20-50% эффективнее JSON
Протокольный overhead: HTTP/2 в gRPC обеспечивает multiplexing, снижая задержки
Сериализация: Protobuf сериализация в 2-10 раз быстрее JSON

## 6. Заключение
Проведённое нагрузочное тестирование показало значительное преимущество gRPC над REST в контексте производительности и эффективности. При сопоставимой функциональности gRPC обеспечивает:
В 1.5-5.5 раз меньшую задержку
В 3 раза большую пропускную способность
100% доступность против 57% у REST
Лучшую масштабируемость до 300 конкурентных пользователей

Несмотря на преимущества gRPC, REST остаётся предпочтительным выбором для публичных API, где важна простота интеграции и поддержка разнообразных клиентов.
Основная рекомендация: Для внутренней микросервисной архитектуры использовать gRPC, для публичных API — REST с оптимизацией тестовых сценариев и добавлением мониторинга ключевых метрик.

